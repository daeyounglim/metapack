<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Daeyoung Lim" />

<meta name="date" content="2020-12-20" />

<title>Introduction to metapack</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to metapack</h1>
<h4 class="author">Daeyoung Lim</h4>
<h4 class="date">2020-12-20</h4>



<p>The <strong>metapack</strong> package contains two main functions interfacing C++ using <strong>Rcpp</strong> <span class="citation">(Eddelbuettel and Balamuta 2017)</span> and <strong>RcppArmadillo</strong> <span class="citation">(Eddelbuettel and Sanderson 2014)</span>: <code>bayes.parobs</code> and <code>bayes.nmr</code>. <code>bayes.parobs</code> fits multivariate meta-regression models with a partially observed sample covariance matrix <span class="citation">(Yao et al. 2015)</span>, and <code>bayes.nmr</code> fits the network meta-regression models. We refer the readers to <a href="#appx">the Appendix</a> for the mathematical formulations of the models.</p>
<p>To use either of our functions, <code>bayes.parobs</code> and <code>bayes.nmr</code>, the data set must be preprocessed into the following format, with the only exception that <code>bayes.nmr</code> has <code>ZCovariate</code> instead of <code>WCovariate</code> to be consistent with the mathematical notation in the original paper.</p>
<p><a name="table-1"></a></p>
<table>
<colgroup>
<col width="16%"></col>
<col width="7%"></col>
<col width="21%"></col>
<col width="21%"></col>
<col width="12%"></col>
<col width="12%"></col>
<col width="8%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center">Outcome</th>
<th align="center">SD</th>
<th align="center">XCovariate</th>
<th align="center">WCovariate</th>
<th align="center">Trial (<code>k</code>)</th>
<th align="center">Treat (<code>t</code>)</th>
<th align="center">Npt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(\bar{y}_{\cdot 13}\)</span></td>
<td align="center"><span class="math inline">\(S_{13}\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{x}_{13}^\prime\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{w}_{13}^\prime\)</span></td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">1000</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\bar{y}_{\cdot 10}\)</span></td>
<td align="center"><span class="math inline">\(S_{10}\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{x}_{10}^\prime\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{w}_{20}^\prime\)</span></td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1000</td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\bar{y}_{\cdot 20}\)</span></td>
<td align="center"><span class="math inline">\(S_{20}\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{x}_{20}^\prime\)</span></td>
<td align="center"><span class="math inline">\(\boldsymbol{w}_{20}^\prime\)</span></td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">1000</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="center"><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
<p>The functions requires the data to be formatted in a way that every row corresponds to a unique pair of <span class="math inline">\((t,k)\)</span> which stands for <span class="math inline">\(t\)</span>th treatment and <span class="math inline">\(k\)</span>th trial. Therefore, <span class="math inline">\(\bar{y}_{\cdot tk}\)</span> and <span class="math inline">\(S_{tk}\)</span> are <span class="math inline">\(J\)</span>-dimensional row vectors for <code>bayes.parobs</code>, and scalars for <code>bayes.nmr</code>.</p>
<div id="fitting-multivariate-meta-regression-with-bayes.parobs" class="section level2">
<h2>Fitting multivariate meta-regression with <code>bayes.parobs</code></h2>
<p>The variables included in the <a href="#table-1">Table</a> are required for <code>bayes.parobs</code>. The key argument in <code>bayes.parobs</code> is <code>fmodel</code> which specifies the model for the error covariance matrix. The objects enclosed in parentheses at the end of every bullet point are the hyperparameters associated with each model.</p>
<p><a name="model-spec"></a></p>
<ul>
<li><code>fmodel=1</code> - <span class="math inline">\(\Sigma_{tk} = \mathrm{diag}(\sigma_{tk,11}^2,\ldots,\sigma_{tk,JJ}^2)\)</span> where <span class="math inline">\(\sigma_{tk,jj}^2 \sim \mathcal{IG}(a_0,b_0)\)</span> and <span class="math inline">\(\mathcal{IG}(a,b)\)</span> is <a href="https://en.wikipedia.org/wiki/Inverse-gamma_distribution">the inverse-gamma distribution</a>. This specification is useful if the user does not care about the correlation recovery. (<code>c0</code>, <code>dj0</code>, <code>a0</code>, <code>b0</code>, <code>Omega0</code>)</li>
<li><code>fmodel=2</code> - <span class="math inline">\(\Sigma_{tk}=\Sigma\)</span> for every combination of <span class="math inline">\((t,k)\)</span> and <span class="math inline">\(\Sigma^{-1}\sim\mathcal{W}_{s_0}(\Sigma_0)\)</span>. This specification assumes that the user has prior knowledge that the correlation structure does not change across the arms included. (<code>c0</code>, <code>dj0</code>, <code>s0</code>, <code>Omega0</code>, <code>Sigma0</code>)</li>
<li><code>fmodel=3</code> - <span class="math inline">\(\Sigma_{tk}=\Sigma_t\)</span> and <span class="math inline">\(\Sigma_t^{-1}\sim \mathcal{W}_{s_0}(\Sigma_0)\)</span>. This is a relaxed version of <code>fmodel=2</code>, allowing the correlation structure to differ across trials but forcing it to stay identical within a trial. (<code>c0</code>, <code>dj0</code>, <code>s0</code>, <code>Omega0</code>, <code>Sigma0</code>)</li>
<li><code>fmodel=4</code> - <span class="math inline">\(\Sigma_{tk}=\boldsymbol{\delta}_{tk}\boldsymbol{\rho}\boldsymbol{\delta}_{tk}\)</span> where <span class="math inline">\(\boldsymbol{\delta}_{tk}=\mathrm{diag}(\Sigma_{tk,11}^{1/2},\ldots,\Sigma_{tk,JJ}^{1/2})\)</span>, and <span class="math inline">\(\boldsymbol{\rho}\)</span> is the correlation matrix. This specification allows the variances to vary across arms but requires that the correlations be the same. This is due to the lack of correlation information in the data, which would in turn lead to the nonidentifiability of the correlations if they were allowed to vary. However, this still is an ambitious model which permits maximal degrees of freedom in terms of variance and correlation estimation. (<code>c0</code>, <code>dj0</code>, <code>a0</code>, <code>b0</code>, <code>Omega0</code>)</li>
<li><code>fmodel=5</code> - The fifth model is hierarchical and thus may require more data than the others: <span class="math inline">\((\Sigma_{tk}^{-1}\mid \Sigma)\sim \mathcal{W}_{\nu_0}((\nu_0-J-1)^{-1}\Sigma^{-1})\)</span> and <span class="math inline">\(\Sigma \sim \mathcal{W}_{d_0}(\Sigma_0)\)</span>. <span class="math inline">\(\Sigma_{tk}\)</span> encodes the within-treatment-arm variation while <span class="math inline">\(\Sigma\)</span> captures the between-treatment-arm variation. The hierarchical structure allows the “borrowing of strength” across treatment arms. (<code>c0</code>, <code>dj0</code>, <code>d0</code>, <code>nu0</code>, <code>Sigma0</code>, <code>Omega0</code>)</li>
</ul>
<p>The remaining optional arguments are</p>
<ul>
<li><code>mcmc</code> - a list for MCMC specification. <code>ndiscard</code> is the number of burn-in iterations. <code>nskip</code> configures the thinning of the MCMC. For instance, if <code>nskip=5</code>, <code>bayes.parobs</code> will save the posterior every 5 iterations. <code>nkeep</code> is the size of the posterior sample. The total number of iterations will be <code>ndiscard + nskip * nkeep</code>.</li>
<li><code>group</code> - a vector containing binary variables for <span class="math inline">\(u_{tk}\)</span>. If not provided, <code>bayes.parobs</code> will assume that there is no grouping and set <span class="math inline">\(u_{tk}=0\)</span> for all <span class="math inline">\((t,k)\)</span>.</li>
<li><code>prior</code> - a list for hyperparameters. Despite <span class="math inline">\(\boldsymbol{\theta}\)</span> in every model, each <code>fmodel</code>, along with the <code>group</code> argument, requires a different set of hyperparameters. Refer to <a href="#model-spec">the itemized model specifications</a>.</li>
<li><code>init</code> - a list of initial values for the parameters to be sampled: <code>theta</code>, <code>gamR</code>, <code>Omega</code>, and <code>Rho</code>. The initial value for <code>Rho</code> will be effective only if <code>fmodel=4</code>.</li>
<li><code>control</code> - a list of tuning parameters for <a href="https://en.wikipedia.org/wiki/Metropolis–Hastings_algorithm">the Metropolis-Hastings algorithm</a>. <code>Rho</code>, <code>R</code>, and <code>delta</code> are sampled through either localized Metropolis algorithm or delayed rejection robust adaptive Metropolis algorithm. <code>*_stepsize</code> with the asterisk replaced with one of the names above specifies the stepsize for determining the sample evaluation points in the localized Metropolis algorithm. <code>sample_Rho</code> can be set to <code>FALSE</code> to suppress the sampling of <code>Rho</code> for <code>fmodel=4</code>. When <code>sample_Rho</code> is <code>FALSE</code>, <span class="math inline">\(\boldsymbol{\rho}\)</span> will be fixed using the value given by the <code>init</code> argument, which defaults to <span class="math inline">\(\boldsymbol{\rho} = 0.5\boldsymbol{I}+0.5\boldsymbol{1}\boldsymbol{1}^\prime\)</span> where <span class="math inline">\(\boldsymbol{1}\)</span> is the vector of ones.</li>
<li><code>scale_x</code> - a Boolean indicating whether <code>XCovariate</code> should be scaled/standardized. The effect of setting this to <code>TRUE</code> is not limited to merely standardizing <code>XCovariate</code>. The following generic functions will scale the posterior sample of <code>theta</code> back to its original unit: <code>plot</code>, <code>fitted</code>, <code>summary</code>, and <code>print</code>. That is, <span class="math inline">\(\theta_j \gets \theta_j/\mathrm{sd}(X_j^*)\)</span> where <span class="math inline">\(X_j^*\)</span> indicates the <span class="math inline">\(j\)</span>th column of <span class="math inline">\(\boldsymbol{X}^*\)</span>.</li>
<li><code>Treat_order</code> - a vector of unique treatments to be used for renumbering the <code>Treat</code> vector. The first element will be assigned treatment zero, potentially indicating placebo. If not provided, the numbering will default to an alphabetical/numerical order.</li>
<li><code>Trial_order</code> - a vector of unique trials. The first element will be assigned zero. If not provided, the numbering will default to an alphabetical/numerical order.</li>
<li><code>group_order</code> - a vector of unique group labels. The first element will be assigned zero. If not provided, the numbering will default to an alphabetical/numerical order</li>
<li><code>verbose</code> - a Boolean indicating whether to print the progress bar during the MCMC sampling.</li>
</ul>
<div id="values" class="section level4">
<h4>Values</h4>
<p><code>bayes.parobs</code> returns</p>
<ul>
<li><code>Outcome</code> - the aggregate response used in the function call.</li>
<li><code>SD</code> - the standard deviation used in the function call.</li>
<li><code>Npt</code> - the number of participants for <code>(t,k)</code> used in the function call.</li>
<li><code>XCovariate</code> - the aggregate design matrix for fixed effects used in the function call. Depending on <code>scale_x</code>, this may differ from the matrix provided at function call.</li>
<li><code>WCovariate</code> - the aggregate design matrix for random effects.</li>
<li><code>Treat</code> - the <em>renumbered</em> treatment indicators. Depending on <code>Treat_order</code>, it may differ from the vector provided at function call.</li>
<li><code>Trial</code> - the <em>renumbered</em> trial indicators. Depending on <code>Trial_order</code>, it may differ from the vector provided at function call.</li>
<li><code>group</code> - the <em>renumbered</em> grouping indicators in the function call. Depending on <code>group_order</code>, it may differ from the vector provided at function call. If <code>group</code> was missing at function call, <code>bayes.parobs</code> will assign <code>NULL</code> for <code>group</code>.</li>
<li><code>TrtLabels</code> - the vector of treatment labels corresponding to the renumbered <code>Treat</code>. This is equivalent to <code>Treat_order</code> if it was given at function call.</li>
<li><code>TrialLabels</code> - the vector of trial labels corresponding to the renumbered <code>Trial</code>. This is equivalent to <code>Trial_order</code> if it was given at function call.</li>
<li><code>GroupLabels</code> - the vector of group labels corresponding to the renumbered <code>group</code>. This is equivalent to <code>group_order</code> if it was given at function call. If <code>group</code> was missing at function call, <code>bayes.parobs</code> will assign <code>NULL</code> for <code>GroupLabels</code>.</li>
<li><code>K</code> - the total number of trials.</li>
<li><code>T</code> - the total number of treatments.</li>
<li><code>fmodel</code> - the model number as described <a href="#model-spec">here</a>.</li>
<li><code>scale_x</code> - a Boolean indicating whether <code>XCovariate</code> has been scaled/standardized.</li>
<li><code>prior</code> - the list of hyperparameters used in the function call.</li>
<li><code>control</code> - the list of tuning parameters used for MCMC in the function call.</li>
<li><code>mcmctime</code> - the elapsed time for the MCMC algorithm in the function call. This does not include all the other preprocessing and post-processing outside of MCMC.</li>
<li><code>mcmc</code> - the list of MCMC specification used in the function call.</li>
<li><code>mcmc.draws</code> - the list containing the MCMC draws. The posterior sample will be accessible here.</li>
</ul>
</div>
<div id="example" class="section level4">
<h4>Example</h4>
<p>The following boilerplate code demonstrates how <code>bayes.parobs</code> can be used:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>Rho_init &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> J)</span>
<span id="cb1-2"><a href="#cb1-2"></a>Rho_init[<span class="kw">upper.tri</span>(Rho_init)] &lt;-<span class="st"> </span>Rho_init[<span class="kw">lower.tri</span>(Rho_init)] &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">bayes.parobs</span>(Outcome, SD, XCovariate, WCovariate, Trial, Treat, Npt,</span>
<span id="cb1-4"><a href="#cb1-4"></a>          <span class="dt">fmodel =</span> <span class="dv">4</span>, <span class="dt">prior =</span> <span class="kw">list</span>(<span class="dt">c0 =</span> <span class="fl">1e6</span>),</span>
<span id="cb1-5"><a href="#cb1-5"></a>          <span class="dt">mcmc =</span> <span class="kw">list</span>(<span class="dt">ndiscard =</span> <span class="fl">1e4</span>, <span class="dt">nskip =</span> <span class="dv">1</span>, <span class="dt">nkeep =</span> <span class="fl">2e4</span>),</span>
<span id="cb1-6"><a href="#cb1-6"></a>          <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">Rho_stepsize=</span><span class="fl">0.05</span>, <span class="dt">R_stepsize=</span><span class="fl">0.05</span>),</span>
<span id="cb1-7"><a href="#cb1-7"></a>          <span class="dt">group =</span> Group,</span>
<span id="cb1-8"><a href="#cb1-8"></a>          <span class="dt">scale_x =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><code>fmodel</code> can be a different number from 1 to 5.</p>
</div>
</div>
<div id="fitting-network-meta-regression-with-bayes.nmr" class="section level2">
<h2>Fitting network meta-regression with <code>bayes.nmr</code></h2>
<p>Unlike <code>bayes.parobs</code>, the aggregate design matrix for random effects, <code>ZCovariate</code>, is optional. If missing, <code>bayes.nmr</code> will assign a vector of ones for <code>ZCovariate</code>, i.e., <span class="math inline">\(\boldsymbol{Z}_k = \boldsymbol{1}\)</span> for all <span class="math inline">\(k\)</span>. This reduces the model to have <span class="math inline">\(\mathrm{Var}(\bar{y}_{tk}) = \sigma_{tk}^2/n_{tk} + \exp(2\phi)\)</span> for every <span class="math inline">\((t,k)\)</span>.</p>
<p>The remaining optional arguments are</p>
<ul>
<li><code>mcmc</code> - a list for MCMC specification. <code>ndiscard</code> is the number of burn-in iterations. <code>nskip</code> configures the thinning of the MCMC. For instance, if <code>nskip=5</code>, <code>bayes.nmr</code> will save the posterior every 5 iterations. <code>nkeep</code> is the size of the posterior sample. The total number of iterations will be <code>ndiscard + nskip * nkeep</code>.</li>
<li><code>prior</code> - a list of hyperparameters. The hyperparameters include <code>df</code>, <code>c01</code>, <code>c02</code>, <code>a4</code>, <code>b4</code>, <code>a5</code>, and <code>b5</code>. <code>df</code> indicates the degrees of freedom whose default value is 20. The hyperparameters <code>a*</code> and <code>b*</code> will take effect only if <code>sample_df=TRUE</code>. See <code>control</code>.</li>
<li><code>control</code> - a list of tuning parameters for <a href="https://en.wikipedia.org/wiki/Metropolis–Hastings_algorithm">the Metropolis-Hastings algorithm</a>. <code>lambda</code>, <code>phi</code>, and <code>Rho</code> are sampled through the localized Metropolis algorithm. <code>*_stepsize</code> with the asterisk replaced with one of the names above specifies the stepsize for determining the sample evaluation points in the localized Metropolis algorithm. <code>sample_Rho</code> can be set to <code>FALSE</code> to suppress the sampling of <code>Rho</code>. When <code>sample_Rho</code> is <code>FALSE</code>, <span class="math inline">\(\boldsymbol{\rho}\)</span> will instantiated using the value given by the <code>init</code> argument, which defaults to <span class="math inline">\(\boldsymbol{\rho} = 0.5\boldsymbol{I}+0.5\boldsymbol{1}\boldsymbol{1}^\prime\)</span> where <span class="math inline">\(\boldsymbol{1}\)</span> is the vector of ones. When <code>sample_df</code> is <code>TRUE</code>, <span class="math inline">\(\nu\)</span> (<code>df</code>) will be sampled.</li>
<li><code>scale_x</code> - a Boolean whether <code>XCovariate</code> should be scaled/standardized. The effect of setting this to <code>TRUE</code> is not limited to merely standardizing <code>XCovariate</code>. The following generic functions will scale the posterior sample of <code>theta</code> back to its original unit: <code>plot</code>, <code>fitted</code>, <code>summary</code>, and <code>print</code>. That is, <span class="math inline">\(\theta_j \gets \theta_j/\mathrm{sd}(X_j^*)\)</span> where <span class="math inline">\(X_j^*\)</span> indicates the <span class="math inline">\(j\)</span>th column of <span class="math inline">\(\boldsymbol{X}^*\)</span>.</li>
<li><code>init</code> - a list of initial values for the parameters to be sampled: <code>theta</code>, <code>phi</code>, <code>sig2</code>, and <code>Rho</code>.</li>
<li><code>Treat_order</code> - a vector of unique treatments to be used for renumbering the <code>Treat</code> vector. The first element will be assigned treatment zero, potentially indicating placebo. If not provided, the numbering will default to an alphabetical/numerical order.</li>
<li><code>Trial_order</code> - a vector of unique trials. The first element will be assigned trial zero. If not provided, the numbering will default to an alphabetical/numerical order.</li>
<li><code>verbose</code> - a Boolean indicating whether to print the progress bar during the MCMC sampling.</li>
</ul>
<div id="values-1" class="section level4">
<h4>Values</h4>
<p><code>bayes.nmr</code> returns</p>
<ul>
<li><code>Outcome</code> - the aggregate response used in the function call.</li>
<li><code>SD</code> - the standard deviation used in the function call.</li>
<li><code>Npt</code> - the number of participants for <code>(t,k)</code> used in the function call.</li>
<li><code>XCovariate</code> - the aggregate design matrix for fixed effects used in the function call. Depending on <code>scale_x</code>, this may differ from the matrix provided at function call.</li>
<li><code>ZCovariate</code> - the aggregate design matrix for random effects. <code>bayes.nmr</code> will assign <code>rep(1, length(Outcome))</code> if it was not provided at function call.</li>
<li><code>Trial</code> - the <em>renumbered</em> trial indicators. Depending on <code>Trial_order</code>, it may differ from the vector provided at function call.</li>
<li><code>Treat</code> - the <em>renumbered</em> treatment indicators. Depending on <code>Treat_order</code>, it may differ from the vector provided at function call.</li>
<li><code>TrtLabels</code> - the vector of treatment labels corresponding to the renumbered <code>Treat</code>. This is equivalent to <code>Treat_order</code> if it was given at function call.</li>
<li><code>TrialLabels</code> - the vector of trial labels corresponding to the renumbered <code>Trial</code>. This is equivalent to <code>Trial_order</code> if it was given at function call.</li>
<li><code>K</code> - the total number of trials.</li>
<li><code>nT</code> - the total number of treatments.</li>
<li><code>scale_x</code> - a Boolean indicating whether <code>XCovariate</code> has been scaled/standardized.</li>
<li><code>prior</code> - the list of hyperparameters used in the function call.</li>
<li><code>control</code> - the list of tuning parameters used for MCMC in the function call.</li>
<li><code>mcmctime</code> - the elapsed time for the MCMC algorithm in the function call. This does not include all the other preprocessing and post-processing outside of MCMC.</li>
<li><code>mcmc</code> - the list of MCMC specification used in the function call.</li>
<li><code>mcmc.draws</code> - the list containing the MCMC draws. The posterior sample will be accessible here.</li>
</ul>
</div>
<div id="example-1" class="section level4">
<h4>Example</h4>
<p>The following boilerplate code demonstrates how <code>bayes.nmr</code> can be used:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>fit &lt;-<span class="st"> </span><span class="kw">bayes.nmr</span>(Outcome, SD, XCovariate, ZCovariate, Trial, Treat, Npt,</span>
<span id="cb2-2"><a href="#cb2-2"></a>        <span class="dt">prior =</span> <span class="kw">list</span>(<span class="dt">c01 =</span> <span class="fl">1.0e05</span>, <span class="dt">c02 =</span> <span class="dv">4</span>, <span class="dt">df =</span> <span class="dv">3</span>),</span>
<span id="cb2-3"><a href="#cb2-3"></a>        <span class="dt">mcmc =</span> <span class="kw">list</span>(<span class="dt">ndiscard =</span> <span class="dv">2500</span>, <span class="dt">nskip =</span> <span class="dv">1</span>, <span class="dt">nkeep =</span> <span class="dv">10000</span>),</span>
<span id="cb2-4"><a href="#cb2-4"></a>        <span class="dt">Treat_order =</span> <span class="kw">c</span>(<span class="st">&quot;PBO&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;P&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>                        <span class="st">&quot;E&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;AE&quot;</span>, <span class="st">&quot;LE&quot;</span>, <span class="st">&quot;PE&quot;</span>),</span>
<span id="cb2-6"><a href="#cb2-6"></a>        <span class="dt">scale_x =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="appx" class="section level2">
<h2>Appendix</h2>
<div id="bayes.parobs" class="section level4">
<h4><code>bayes.parobs</code></h4>
<p>When there are multiple endpoints, the correlations thereof are oftentimes unreported. In a meta-regression setting, the correlations are something we want to know. In the case of subject-level meta-analyses (where individual participant/patient data are available), the correlations may only be one function call away. However, for study-level meta-analyses, the correlations must be estimated, which is not an easy task. <code>bayes.parobs</code> provides five different models to estimate and recover the missing correlations.</p>
<p>Since the aforementioned setting regards the correlations as missing, the reported data are <span class="math inline">\((\overline{\boldsymbol{y}}_{\cdot tk}, \boldsymbol{s}_{tk}) \in \mathbf{R}^J \times \mathbf{R}^J\)</span> for the <span class="math inline">\(t\)</span>th treatment arm and <span class="math inline">\(k\)</span>th trial. Every trial out of <span class="math inline">\(K\)</span> trials includes <span class="math inline">\(T\)</span> treatment arms. The sample size of the <span class="math inline">\(t\)</span>th treatment arm and <span class="math inline">\(k\)</span>th trial is denoted by <span class="math inline">\(n_{tk}\)</span>. If we write <span class="math inline">\(\boldsymbol{x}_{tkj}\in \mathbf{R}^{p_j}\)</span> to be the treatment-within-trial level regressor corresponding to the <span class="math inline">\(j\)</span>th response, reflecting the fixed effects of the <span class="math inline">\(t\)</span>th treatment arm, and <span class="math inline">\(\boldsymbol{w}_{tkj}\in \mathbf{R}^{q_j}\)</span> to be the same for the random effects, the model becomes</p>
<p><span class="math display">\[\begin{equation}\label{eq:1}
\overline{\boldsymbol{y}}_{\cdot tk} = \boldsymbol{X}_{tk}\boldsymbol{\beta} + \boldsymbol{W}_{tk}\boldsymbol{\gamma}_k + \overline{\boldsymbol{\epsilon}}_{\cdot tk},
\end{equation}\]</span></p>
<p>and <span class="math inline">\((n_{tk}-1)S_{tk} \sim \mathcal{W}_{n_{tk}-1}(\Sigma_{tk})\)</span> where <span class="math inline">\(\boldsymbol{X}_{tk} = \mathrm{blockdiag}(\boldsymbol{x}_{tk1}^\prime,\boldsymbol{x}_{tk2}^\prime,\ldots,\boldsymbol{x}_{tkJ}^\prime)\)</span>, <span class="math inline">\(\boldsymbol{\beta} = (\boldsymbol{\beta}_1^\prime, \cdots, \boldsymbol{\beta}_J^\prime)^\prime\)</span>, <span class="math inline">\(\boldsymbol{W}_{tk}=\mathrm{blockdiag}(\boldsymbol{w}_{tk1}^\prime, \ldots,\boldsymbol{w}_{tkJ}^\prime)\)</span>, <span class="math inline">\(\boldsymbol{\gamma}_k = (\boldsymbol{\gamma}_{k1}^\prime,\boldsymbol{\gamma}_{k2}^\prime, \ldots,\boldsymbol{\gamma}_{kJ}^\prime)^\prime\)</span>, <span class="math inline">\(\overline{\boldsymbol{\epsilon}}_{\cdot tk} \sim \mathcal{N}(\boldsymbol{0}, \Sigma_{tk}/n_{tk})\)</span>, <span class="math inline">\(S_{tk}\)</span> is the full-rank covariance matrix whose diagonal entries are the observed <span class="math inline">\(\boldsymbol{s}_{tk}\)</span>, and <span class="math inline">\(\mathcal{W}_\nu(\Sigma)\)</span> is the Wishart distribution with <span class="math inline">\(\nu\)</span> degrees of freedom and a <span class="math inline">\(J\times J\)</span> scale matrix <span class="math inline">\(\Sigma\)</span> whose density function is</p>
<p><span class="math display">\[
f(X\mid \nu,\Sigma) = \dfrac{1}{2^{J\nu}|\Sigma|^{\nu/2}\Gamma_p(\nu/2)}|X|^{(\nu-J-1)/2}\exp\left(-\dfrac{1}{2}\mathrm{tr}(\Sigma^{-1}X) \right)I(X\in \mathcal{S}_{++}^J),
\]</span></p>
<p>where <span class="math inline">\(\Gamma_p\)</span> is the multivariate gamma function defined by</p>
<p><span class="math display">\[
\Gamma_p(z) = \pi^{p(p-1)/4}\prod_{j=1}^p \Gamma[z+(1-j)/2],
\]</span></p>
<p>and <span class="math inline">\(\mathcal{S}_{++}^J\)</span> is the space of <span class="math inline">\(J\times J\)</span> symmetric positive definite matrices. The statistical independence of <span class="math inline">\(\overline{\boldsymbol{\epsilon}}_{\cdot tk}\)</span> and <span class="math inline">\(S_{tk}\)</span> follows naturally from <a href="https://en.wikipedia.org/wiki/Basu%27s_theorem">the Basu’s theorem</a>.</p>
<p>The patients can sometimes be grouped by a factor that will generate disparate random effects. Although an arbitrary number of groups can exist in theory, <strong>metapack</strong> restricts the number of groups to two for practicality. Denoting the binary group indicates by <span class="math inline">\(u_{tk}\)</span> yields</p>
<p><span class="math display">\[
\overline{y}_{\cdot tkj} = \boldsymbol{x}_{tkj}^\prime\boldsymbol{\beta} + (1-u_{tk})\boldsymbol{w}_{tkj}^\prime \boldsymbol{\gamma}_{kj}^0 + u_{tk}\boldsymbol{w}_{tkj}^\prime \boldsymbol{\gamma}_{kj}^1 + \overline{\epsilon}_{\cdot tkj}.
\]</span></p>
<p>The random effects are modeled as <span class="math inline">\(\boldsymbol{\gamma}_{kj}^l \overset{\text{ind}}{\sim}\mathcal{N}(\boldsymbol{\gamma}_j^{l*},\Omega_j^l)\)</span> and <span class="math inline">\((\Omega_j^l)^{-1} \sim \mathcal{W}_{d_{0j}}(\Omega_{0j})\)</span>. Stacking the vectors, <span class="math inline">\(\boldsymbol{\gamma}_k^l = ((\boldsymbol{\gamma}_{k1}^l)^\prime, \ldots, (\boldsymbol{\gamma}_{kJ}^l)^\prime)^\prime \sim \mathcal{N}(\boldsymbol{\gamma}^{l*},\Omega^l)\)</span> where <span class="math inline">\(\boldsymbol{\gamma}^{l*} = ((\boldsymbol{\gamma}_{1}^{l*})^\prime,\ldots,(\boldsymbol{\gamma}_{J}^{l*})^\prime)^\prime\)</span>, <span class="math inline">\(\Omega_j = \mathrm{blockdiag}(\Omega_j^0,\Omega_j^l)\)</span>, and <span class="math inline">\(\Omega = \mathrm{blockdiag}(\Omega_1,\ldots,\Omega_J)\)</span> for <span class="math inline">\(l \in \{0,1\}\)</span>. Adopting the non-centered reparametrization <span class="citation">(Bernardo et al. 2003)</span>, define <span class="math inline">\(\boldsymbol{\gamma}_{k,o}^l = \boldsymbol{\gamma}_k^l - \boldsymbol{\gamma}^{l*}\)</span>. Denoting <span class="math inline">\(\boldsymbol{W}_{tk}^* = [(1-u_{tk})\boldsymbol{W}_{tk}, u_{tk}\boldsymbol{W}_{tk}]\)</span>, <span class="math inline">\(\boldsymbol{X}_{tk}^* = [\boldsymbol{X}_{tk},\boldsymbol{W}_{tk}^*]\)</span>, and <span class="math inline">\(\boldsymbol{\theta} = (\boldsymbol{\beta}^\prime, {\boldsymbol{\gamma}^{0*}}^\prime, {\boldsymbol{\gamma}^{1*}}^\prime)^\prime\)</span>, the model is written as follows:</p>
<p><span class="math display">\[
\overline{\boldsymbol{y}}_{\cdot tk} = \boldsymbol{X}_{tk}^*\boldsymbol{\theta}+\boldsymbol{W}_{tk}^*\boldsymbol{\gamma}_{k,o} + \overline{\boldsymbol{\epsilon}}_{\cdot tk},
\]</span> where <span class="math inline">\(\boldsymbol{\gamma}_{k,o} = ((\boldsymbol{\gamma}_{k,o}^0)^\prime, (\boldsymbol{\gamma}_{k,o}^1)^\prime)^\prime\)</span>. If there is no grouping in the patients, setting <span class="math inline">\(u_{tk}=0\)</span> for all <span class="math inline">\((t,k)\)</span> reduces the model back to <span class="citation">(<span class="citeproc-not-found" data-reference-id="eq:1"><strong>???</strong></span>)</span>.</p>
</div>
</div>
<div id="reference" class="section level2 unnumbered">
<h2>Reference</h2>
<div id="refs" class="references">
<div id="ref-bernardo2003non">
<p>Bernardo, JM, MJ Bayarri, JO Berger, AP Dawid, D Heckerman, AFM Smith, and M West. 2003. “Non-Centered Parameterisations for Hierarchical Models and Data Augmentation.” In <em>Bayesian Statistics 7: Proceedings of the Seventh Valencia International Meeting</em>. Vol. 307. Oxford University Press, USA.</p>
</div>
<div id="ref-Rcpp2017">
<p>Eddelbuettel, Dirk, and James Joseph Balamuta. 2017. “Extending R with C++: A Brief Introduction to Rcpp.” <em>PeerJ Preprints</em> 5 (August): e3188v1. <a href="https://doi.org/10.7287/peerj.preprints.3188v1">https://doi.org/10.7287/peerj.preprints.3188v1</a>.</p>
</div>
<div id="ref-RcppArmadillo2014">
<p>Eddelbuettel, Dirk, and Conrad Sanderson. 2014. “RcppArmadillo: Accelerating R with High-Performance C++ Linear Algebra.” <em>Computational Statistics and Data Analysis</em> 71: 1054–63. <a href="http://dx.doi.org/10.1016/j.csda.2013.02.005">http://dx.doi.org/10.1016/j.csda.2013.02.005</a>.</p>
</div>
<div id="ref-yao2015bayesian">
<p>Yao, Hui, Sungduk Kim, Ming-Hui Chen, Joseph G Ibrahim, Arvind K Shah, and Jianxin Lin. 2015. “Bayesian Inference for Multivariate Meta-Regression with a Partially Observed Within-Study Sample Covariance Matrix.” <em>Journal of the American Statistical Association</em> 110 (510): 528–44.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
